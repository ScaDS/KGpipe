# Pipeline Defintion

# ========
# RDF SSPs
# ========

rdf_a:
    description: "Align source RDF with target KG"
    config:
        ENTITY_MATCHING_THRESHOLD: "0.99"
        RELATION_MATCHING_THRESHOLD: "0.5"
    tasks:
        # 1 Use paris matcher to match source and target RDF
        - paris_entity_matching
        # 2 Convert paris csv to entity resolution primary format
        - paris_exchange
        # 3 Fuse matched RDF (threshold 0.5)
        - fusion_first_value
        - type_inference_ontology_simple

rdf_b:
    description: "Align source RDF with target KG with a tabular matching approach"
    config:
        ENTITY_MATCHING_THRESHOLD: "0.5"
        RELATION_MATCHING_THRESHOLD: "0.1"
    tasks:
        - transform2_rdf_to_csv_v2
        - pyjedai_entity_matching_v2
        - reduce_to_best_match_per_entity
        - valentine_csv_matching_v2
        - aggregate_2matches
        - fusion_first_value
        - type_inference_ontology_simple

rdf_llm_schema_align_v1:
    description: "Align relations of source RDF with target KG using LLM"
    config:
        ENTITY_MATCHING_THRESHOLD: "0.5"
        RELATION_MATCHING_THRESHOLD: "1.0"
        LLM_MODEL: "gpt-5-mini"
    tasks:
        # 1 Use LLM to match relations
        - llm_task_rdf_ontology_matching_v1 # results in er.json
        # 2 Map source KG relations to matching target KG relations
        # - map_kg_alignments
        - map_er_match_relations
        # 3 Match entities with paris
        - paris_entity_matching
        # 4 Exchange matched RDF
        - paris_exchange
        - aggregate_2matches
        # 5 Fuse matched RDF maybe only entities
        - fusion_first_value
        - type_inference_ontology_simple

# =========
# JSON SSPs
# =========

json_a:
    description: "Construct intermediate RDF from JSON"
    tasks:
        # 1 Nested tree Json to generic RDF graph
        - construct_rdf_from_json3
        # 2 Match RDF graph with seed
        - paris_entity_matching
        # 3 exchange 
        - paris_exchange
        # 4 Fuse matched RDF (threshold 0.5)
        - fusion_first_value
        - type_inference_ontology_simple


json_baseA:
    description: "Construct intermediate RDF from JSON"
    config:
        ENTITY_MATCHING_THRESHOLD: "0.99"
        RELATION_MATCHING_THRESHOLD: "0.5"
    tasks:
        # 1 Nested tree Json to generic RDF graph
        - construct_rdf_from_json_base
        # 2 Match RDF graph with seed
        - paris_entity_matching
        # 3 exchange 
        - paris_exchange
        # 4 Fuse matched RDF (threshold 0.5)
        - fusion_first_value
        - type_inference_ontology_simple


json_b:
    description: "Link JSON objects to target KG"
    tasks:
        # construct TE_Document from JSON
        - construct_linkedrdf_from_json_v3 # extract_json.py
        # 4 Fuse matched RDF (threshold 0.5)
        - select_first_value
        - type_inference_ontology_simple

json_llm_mapping_v1:
    description: "Align JSON path to target KG (ontology + sample KG)"
    tasks:
        - llm_task_map_and_construct
        - aggregate_rdf_files
        - paris_entity_matching
        - paris_exchange
        - fusion_first_value
        - type_inference_ontology_simple

# =========
# Text SSPs
# =========

text_a:
    description: "Use spoltight build RDF stagging Graph and apply Paris matching"
    tasks:
        - corenlp_openie_extraction
        - corenlp_exchange
        - label_alias_embedding_rl
        - dbpedia_spotlight_ner_nel
        - dbpedia_spotlight_exchange
        - aggregate3_te_json
        - construct_rdf_from_te_json_mappings_only
        - paris_entity_matching
        - paris_exchange
        - fusion_first_value
        - type_inference_ontology_simple


text_b:
    description: "(semi expensive) Use mini transformer to link entities and relations (label+alias)"
    tasks:
        - corenlp_openie_extraction # ("Berlin", "is a", "city")
        - corenlp_exchange
        - label_alias_embedding_el # ("Berlin" -> http://dbpedia.org/resource/Berlin)
        - label_alias_embedding_rl # ("is a" -> "rdf:type")
        - aggregate3_te_json
        - construct_rdf_from_te_json
        - select_first_value
        - type_inference_ontology_simple

text_llm_triple_extract_v1:
    description: "Extract RDF from TEXT using LLM"
    config:
        LLM_MODEL: "gpt-5-mini"
    tasks:
        - llm_task_text_triple_extract_v1
        - label_alias_embedding_el # ("Berlin" -> http://dbpedia.org/resource/Berlin)
        - label_alias_embedding_rl # ("is a" -> "rdf:type")
        - aggregate3_te_json
        - construct_rdf_from_te_json
        - select_first_value
        - type_inference_ontology_simple
        # - type_inference_ontology_simple TODO why was this commented

